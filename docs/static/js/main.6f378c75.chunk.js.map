{"version":3,"sources":["components/Extension/ExportBtn/ExportBtn.js","components/func/func.js","components/Extension/Extension.js","components/Configure/SelectSheets/Sheet/Sheet.js","components/Configure/SelectSheets/SelectSheets.js","components/Configure/SelectColumns/Sheet/Column/Column.js","components/Configure/SelectColumns/Sheet/Sheet.js","components/Configure/SelectColumns/SelectColumns.js","components/Configure/ActionButtons/ActionButtons.js","components/Configure/ConfigureTab/ConfigureTab.js","components/Configure/logo.svg","components/Configure/Configure.js","components/DesktopExport/DesktopExport.js","containers/Main.js","serviceWorker.js","index.js"],"names":["ExportBtn","props","kind","style","disabled","onClick","export","label","saveSettings","Promise","resolve","reject","console","log","tableau","extensions","settings","set","environment","mode","saveAsync","then","newSavedSettings","catch","setSettings","type","value","settingKey","JSON","stringify","getSheetColumns","sheet","existingCols","modified","getSummaryDataAsync","ignoreSelection","data","columns","cols","existingIdx","j","length","col","index","name","fieldName","dataType","changeName","selected","push","i","hasOwnProperty","maxPos","map","idx","eIdx","indexOf","ret","order","k","newCol","sort","a","b","error","initializeMeta","promises","meta","dashboardContent","_dashboard","worksheets","worksheet","item","sheetName","customCols","all","sheetArr","sheetMeta","revalidateMeta","existing","sheetIdx","findIndex","e","existed","forEach","arr","old_index","new_index","undefined","splice","array_move","exportToExcel","env","filename","xlsFile","buildExcelBlob","wb","wbout","XLSX","write","bookType","bookSST","ignoreEC","saveAs","Blob","dashboard","utils","book_new","totalSheets","sheetCount","sheetList","columnList","tabNames","tabName","replace","metaSheet","find","s","columnMeta","headerOrder","colMeta","column","objCol","o","outputName","decodeDataset","rows","ws","json_to_sheet","header","sheetname","book_append_sheet","dataset","decodeRow","datasetArr","row","dtype","dval","nativeValue","formattedValue","_dataType","Number","isNaN","v","t","Extension","refreshSettings","sheetSettings","get","existingSettings","parse","updateMeta","disableButton","labelSettings","updateLabel","styleSettings","updateButtonStyle","filenameSettings","updateFilename","configure","popupUrl","window","location","origin","ui","displayDialogAsync","height","width","closePayload","errorCode","ErrorCodes","DialogClosedByUser","message","useEffect","initializeAsync","metaVersion","updateMetaVersion","context","tableauVersion","compareVersions","compare","desktopExportHandler","useStyles","makeStyles","theme","root","heading","fontSize","typography","pxToRem","details","alignItems","flexBasis","display","lineHeight","group","color","flexDirection","fontFamily","position","strikeThrough","textDecoration","marginRight","Accordion","withStyles","boxShadow","borderBottom","margin","expanded","MuiAccordion","Sheet","rename","classes","inputProps","onChange","target","onClear","placeholder","className","square","AccordionSummary","aria-controls","id","checked","select","AccordionDetails","min","max","sheets","step","pageSteps","onValueChange","changeOrder","stepper","SelectSheets","selectSheet","newPos","ExpansionPanel","Column","expandIcon","Sheets","colSelect","SelectColumns","placeButtons","bottom","right","version","left","ActionButtons","packageJson","resetSettings","enableButton","save","flexGrow","gridItem","marginTop","ConfigureTab","labelProps","filenameProps","Grid","container","xs","Fragment","marginLeft","configBody","logoBanner","backgroundColor","paddingTop","paddingBottom","paddingLeft","Configure","useState","tab","switchTab","initializeDialogAsync","openPayload","src","logo","alt","onTabChange","selectedTabIndex","tabs","content","changeSettings","colIdx","enableSave","savedSettings","DesktopExport","spacing","align","justify","Typography","component","padding","Main","metaVersionChangedHandler","setState","labelChangedHandler","labelTxt","button","state","filenameChangedHandler","buttonStateChangedHandler","buttonStyleChangedHandler","metaChangedHandler","newSettings","settingsChangedHandler","settingsChanged","resetSettingsHandler","isLoading","renderExtension","renderConfigure","renderDesktopExport","path","this","Component","Boolean","hostname","match","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.6f378c75.chunk.js","sourcesContent":["import React from 'react';\r\nimport { Button } from '@tableau/tableau-ui';\r\n\r\nfunction ExportBtn(props) {\r\n  return (\r\n      <div>\r\n         <Button kind={props.style} disabled={props.disabled} onClick={props.export}>{props.label}</Button>\r\n      </div>\r\n  );\r\n}\r\n\r\nexport default ExportBtn;\r\n","import XLSX from 'xlsx';\r\nimport { saveAs } from 'file-saver';\r\n\r\n// Declare this so our linter knows that tableau is a global object\r\n/* global tableau */\r\n\r\n\r\n//array_move function from stackoverflow solution:\r\n//https://stackoverflow.com/questions/5306680/move-an-array-element-from-one-array-position-to-another\r\nfunction array_move(arr, old_index, new_index) {\r\n  if (new_index >= arr.length) {\r\n      var k = new_index - arr.length + 1;\r\n      while (k--) {\r\n          arr.push(undefined);\r\n      }\r\n  }\r\n  arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);\r\n  return arr; // for testing\r\n};\r\n\r\nconst saveSettings = () => new Promise((resolve, reject) => {\r\n  console.log('[func.js] Saving settings');\r\n  tableau.extensions.settings.set('metaVersion', 2);\r\n  console.log('[func.js] Authoring mode', tableau.extensions.environment.mode);\r\n  if (tableau.extensions.environment.mode === \"authoring\") {\r\n    tableau.extensions.settings.saveAsync()\r\n    .then(newSavedSettings => {\r\n      //console.log('[func.js] newSavedSettings', newSavedSettings);\r\n      resolve(newSavedSettings);\r\n    }).catch(reject);\r\n  } else {\r\n    resolve();\r\n  }\r\n  \r\n});\r\n\r\nconst setSettings = (type, value) => new Promise((resolve, reject) => {\r\n  console.log('[func.js] Set settings', type, value);\r\n  let settingKey = '';\r\n  switch(type) {\r\n    case 'sheets':\r\n      settingKey = 'selectedSheets';\r\n      break;\r\n    case 'label':\r\n      settingKey = 'buttonLabel';\r\n      break;\r\n    case 'style':\r\n      settingKey = 'buttonStyle';\r\n      break;\r\n    case 'filename':\r\n      settingKey = 'filename';\r\n      break;\r\n    case 'version':\r\n      settingKey = 'metaVersion';\r\n      break;\r\n    default:\r\n      settingKey = 'unknown';\r\n  }\r\n  tableau.extensions.settings.set(settingKey, JSON.stringify(value));\r\n  resolve();\r\n});\r\n\r\nconst getSheetColumns = (sheet, existingCols, modified) => new Promise((resolve, reject) => {\r\n  sheet.getSummaryDataAsync({ignoreSelection: true}).then((data) => {\r\n    //console.log('[func.js] Sheet Summary Data', data);\r\n    console.log('[func.js] getSheetColumns existingCols', JSON.stringify(existingCols));\r\n    const columns = data.columns;\r\n    let cols = [];\r\n    const existingIdx = [];\r\n    if (modified) {\r\n      for (var j = 0; j < columns.length; j++) {\r\n        //console.log(columns[j]);\r\n        var col = {};\r\n        col.index = columns[j].index;\r\n        col.name = columns[j].fieldName;\r\n        col.dataType = columns[j].dataType;\r\n        col.changeName = null;\r\n        col.selected = false;\r\n        cols.push(col);\r\n      }\r\n      for (var i = 0; i < existingCols.length; i++) {\r\n        if (existingCols[i] && existingCols[i].hasOwnProperty(\"name\")) {\r\n          existingIdx.push(existingCols[i].name);\r\n        }\r\n      }\r\n      console.log('[func.js] getSheetColumns existingIdx', existingIdx);\r\n      let maxPos = existingIdx.length;\r\n      cols = cols.map((col, idx) => {\r\n        //console.log('[func.js] getSheetColumns Looking for col', col);\r\n        const eIdx = existingIdx.indexOf(col.name);\r\n        const ret = {...col};\r\n        if (eIdx > -1) {\r\n          ret.selected = existingCols[eIdx].selected;\r\n          ret.changeName = existingCols[eIdx].changeName;\r\n          ret.order = eIdx;\r\n        } else {\r\n          ret.order = maxPos;\r\n          maxPos += 1;\r\n        }\r\n        return ret;\r\n      });\r\n    } else {\r\n      for (var k = 0; k < columns.length; k++) {\r\n        var newCol = {};\r\n        newCol.index = columns[k].index;\r\n        newCol.name = columns[k].fieldName;\r\n        newCol.dataType = columns[k].dataType;\r\n        newCol.selected = true;\r\n        newCol.order = k + 1;\r\n        cols.push(newCol);\r\n      }\r\n    }\r\n    cols = cols.sort((a, b) => (a.order > b.order) ? 1 : -1)\r\n    resolve(cols);\r\n  })\r\n  .catch(error => {\r\n    console.log('[func.js] Error with getSummaryDataAsync', sheet, error);\r\n  });\r\n});\r\n\r\nconst initializeMeta = () => new Promise((resolve, reject) => {\r\n  console.log('[func.js] Initialise Meta');\r\n  var promises = [];\r\n  const worksheets = tableau.extensions.dashboardContent._dashboard.worksheets;\r\n  //console.log('[func.js] Worksheets in dashboard', worksheets);\r\n  var meta = worksheets.map(worksheet => {\r\n    var sheet = worksheet;\r\n    var item = {};\r\n    item.sheetName = sheet.name;\r\n    item.selected = false;\r\n    item.changeName = null;\r\n    item.customCols = false;\r\n    promises.push(getSheetColumns(sheet, null, false));\r\n    return item;\r\n  });\r\n\r\n  console.log(`[func.js] Found ${meta.length} sheets`, meta);\r\n\r\n  Promise.all(promises).then((sheetArr) => {\r\n    for (var i = 0; i < sheetArr.length; i++) {\r\n      var sheetMeta = meta[i];\r\n      sheetMeta.columns = sheetArr[i];\r\n      meta[i] = sheetMeta;\r\n      console.log(`[func.js] Added ${sheetArr[i].length} columns to ${sheetMeta.sheetName}`, meta);\r\n    }\r\n    //console.log(`[func.js] Meta initialised`, meta);\r\n    resolve(meta);\r\n  });\r\n});\r\n\r\nconst revalidateMeta = (existing) => new Promise((resolve, reject) => {\r\n  console.log('[func.js] Revalidate Meta');\r\n  var promises = [];\r\n  const worksheets = tableau.extensions.dashboardContent._dashboard.worksheets;\r\n  //console.log('[func.js] Worksheets in dashboard', worksheets);\r\n  var meta = worksheets.map(worksheet => {\r\n    var sheet = worksheet;\r\n    const sheetIdx = existing.findIndex((e) => {\r\n      return e.sheetName === sheet.name;\r\n    });\r\n    if (sheetIdx > -1) {\r\n      console.log(`[func.js] Existing sheet ${sheet.name} columns`, JSON.stringify(existing[sheetIdx].columns));\r\n      promises.push(getSheetColumns(sheet, existing[sheetIdx].columns, true));\r\n      existing[sheetIdx].existed = true;\r\n      return existing[sheetIdx];\r\n    } else {\r\n      var item = {};\r\n      item.sheetName = sheet.name;\r\n      item.selected = false;\r\n      item.changeName = null;\r\n      item.customCols = false;\r\n      item.existed = false;\r\n      promises.push(getSheetColumns(sheet, null, false));\r\n      return item;\r\n    }\r\n  });\r\n\r\n  console.log(`[func.js] Found ${meta.length} sheets`, meta);\r\n\r\n  Promise.all(promises).then((sheetArr) => {\r\n\r\n    for (var i = 0; i < sheetArr.length; i++) {\r\n      var sheetMeta = meta[i];\r\n      sheetMeta.columns = sheetArr[i];\r\n      meta[i] = sheetMeta;\r\n      //console.log(`[func.js] Added ${sheetArr[i].length} columns to ${sheetMeta.sheetName}`, meta);\r\n    }\r\n    meta.forEach((sheet, idx) => {\r\n      if (sheet && sheet.sheetName) {\r\n        const eIdx = existing.findIndex((e) => {\r\n          return e.sheetName === sheet.sheetName;\r\n        });\r\n        meta = array_move(meta, idx, eIdx);\r\n      } else {\r\n        console.log('[func.js] Sheet ordering issue. No sheet defined in idx', idx);\r\n      }\r\n    })\r\n    console.log(`[func.js] Meta revalidated`, JSON.stringify(meta));\r\n    resolve(meta);\r\n  });\r\n});\r\n\r\nconst exportToExcel = (meta, env, filename) => new Promise((resolve, reject) => {\r\n  let xlsFile = \"export.xlsx\";\r\n  if (filename && filename.length > 0) {\r\n    xlsFile = filename + \".xlsx\";\r\n  }\r\n  buildExcelBlob(meta).then(wb => {\r\n    // add ignoreEC:false to prevent excel crashes during text to column\r\n    var wopts = { bookType:'xlsx', bookSST:false, type:'array', ignoreEC:false };\r\n    var wbout = XLSX.write(wb,wopts);\r\n    saveAs(new Blob([wbout],{type:\"application/octet-stream\"}), xlsFile);\r\n    resolve();\r\n  });\r\n});\r\n\r\n\r\n\r\n// krisd: move excel creation to caller (to support extra export to methodss)\r\n// callback receives a blob to save or transfer\r\nconst buildExcelBlob = (meta) => new Promise((resolve, reject) => {\r\n  console.log(\"[func.js] Got Meta\", meta);\r\n  // func.saveSettings(meta, function(newSettings) {\r\n    // console.log(\"Saved settings\", newSettings);\r\n  const worksheets = tableau.extensions.dashboardContent.dashboard.worksheets;\r\n  const wb = XLSX.utils.book_new();\r\n  let totalSheets = 0;\r\n  let sheetCount = 0;\r\n  const sheetList = [];\r\n  const columnList = [];\r\n  const tabNames = [];\r\n  for (let i =0; i < meta.length; i++) {\r\n    if (meta[i] && meta[i].selected) {\r\n      let tabName = meta[i].changeName || meta[i].sheetName;\r\n      tabName = tabName.replace(/[*?/\\\\[\\]]/gi, '');\r\n      sheetList.push(meta[i].sheetName);\r\n      tabNames.push(tabName);\r\n      columnList.push(meta[i].columns);\r\n      totalSheets = totalSheets + 1;\r\n    }\r\n  }\r\n  sheetList.map((metaSheet, idx) => {\r\n    //console.log(\"[func.js] Finding sheet\", metaSheet, worksheets);\r\n    const sheet = worksheets.find(s => s.name === metaSheet);\r\n    // eslint-disable-next-line\r\n    sheet.getSummaryDataAsync({ignoreSelection: true}).then((data) => {\r\n      const columns = data.columns;\r\n      const columnMeta = columnList[sheetCount];\r\n      const headerOrder = [];\r\n      columnMeta.map((colMeta, idx) => {\r\n        if (colMeta && colMeta.selected) {\r\n          headerOrder.push(colMeta.changeName || colMeta.name);\r\n        }\r\n        return colMeta;\r\n      });\r\n      columns.map((column, idx) => {\r\n        //console.log(\"[func.js] Finding column\", column.fieldName, columnMeta);\r\n        const objCol = columnMeta.find(o => o.name === column.fieldName);\r\n        if (objCol) {\r\n          let col = { ...column, selected: objCol.selected  }\r\n          col.outputName = objCol.changeName || objCol.name;\r\n          columns[idx] = col;\r\n          return col;\r\n        } else {\r\n          return null;\r\n        }\r\n      });\r\n      //console.log(\"[func.js] Running decodeRows\", columns, data.data);\r\n      decodeDataset(columns, data.data)\r\n        .then((rows) => {\r\n          //console.log(\"[func.js] decodeRows returned\", rows);\r\n          console.log(\"[func.js] Header Order\", headerOrder);\r\n          var ws = XLSX.utils.json_to_sheet(rows, {header: headerOrder});\r\n          var sheetname = tabNames[sheetCount];\r\n          sheetCount = sheetCount + 1;\r\n          XLSX.utils.book_append_sheet(wb, ws, sheetname);\r\n          if (sheetCount === totalSheets) {\r\n            resolve(wb);\r\n          }\r\n      });\r\n    });\r\n    return sheet;\r\n  });\r\n});\r\n\r\n\r\n// krisd: Remove recursion to work with larger data sets\r\n// and translate cell data types\r\nconst decodeDataset = (columns, dataset) => new Promise((resolve, reject) => {\r\n  let promises = [];\r\n  for (let i=0; i<dataset.length; i++) {\r\n    promises.push(decodeRow(columns, dataset[i]));\r\n  }\r\n  Promise.all(promises).then((datasetArr) => {\r\n    //console.log('[func.js] datasetArr', datasetArr);\r\n    resolve(datasetArr);\r\n  });\r\n\r\n});\r\n\r\nconst decodeRow = (columns, row) => new Promise((resolve, reject) => {\r\n  let meta = {};\r\n  for (let j = 0; j < columns.length; j++) {\r\n    if (columns[j].selected) {\r\n      // krisd: let's assign the sheetjs type according to the summary data column type\r\n      let dtype = undefined;\r\n      let dval = undefined;\r\n      // console.log('[func.js] Row', row[j]);\r\n      if (row[j].value === '%null%' && row[j].nativeValue === null && row[j].formattedValue === 'Null') {\r\n        dtype = 'z';\r\n        dval = null;\r\n      } else {\r\n        switch (columns[j]._dataType) {\r\n          case 'int':\r\n          case 'float':\r\n            dtype = 'n';\r\n            dval = Number(row[j].value);  // let nums be raw w/o formatting\r\n            if (isNaN(dval)) dval = row[j].formattedValue;  // protect in case issue\r\n            break;\r\n          case 'date':\r\n          case 'date-time':\r\n            dtype = 's';\r\n            dval = row[j].formattedValue;\r\n            break;\r\n          case 'bool':\r\n            dtype = 'b';\r\n            dval = row[j].value;\r\n            break;\r\n          default:\r\n            dtype = 's';\r\n            dval = row[j].formattedValue;\r\n        }\r\n      }\r\n      let o = {v:dval, t:dtype};\r\n      meta[columns[j].outputName] = o;\r\n    }\r\n  }\r\n  resolve(meta);\r\n});\r\n\r\n\r\n\r\nexport {\r\n  initializeMeta,\r\n  revalidateMeta,\r\n  saveSettings,\r\n  setSettings,\r\n  exportToExcel,\r\n}\r\n","import React, { useEffect } from 'react';\r\nimport ExportBtn from './ExportBtn/ExportBtn';\r\nimport { initializeMeta, revalidateMeta, saveSettings, setSettings, exportToExcel } from '../func/func';\r\nimport compareVersions from 'compare-versions';\r\n\r\n// Declare this so our linter knows that tableau is a global object\r\n/* global tableau */\r\n\r\nfunction Extension (props) {\r\n\r\n  useEffect(() => {\r\n    console.log('[Extension.js] Props Changed', props);\r\n  }, [props]);\r\n\r\n  useEffect(() => {\r\n    console.log('[Extension.js] useEffect');\r\n    //console.log('[Extension.js] Initialise Extension', props);\r\n    //Initialise Extension\r\n    tableau.extensions.initializeAsync({'configure': configure}).then(() => {\r\n\r\n      let metaVersion = tableau.extensions.settings.get('metaVersion');\r\n\r\n      if (metaVersion) {\r\n        console.log('[Extension.js] Meta Version', metaVersion);\r\n        props.updateMetaVersion(metaVersion);\r\n      } else {\r\n        console.log('[Extension.js] Meta Version', 1);\r\n        metaVersion = 1;\r\n        props.updateMetaVersion(1);\r\n      }\r\n\r\n      let sheetSettings = tableau.extensions.settings.get('selectedSheets');\r\n\r\n      if (sheetSettings && sheetSettings != null) {\r\n        console.log('[Extension.js] Existing Sheet Settings Found', JSON.parse(sheetSettings));\r\n        props.updateMeta(JSON.parse(sheetSettings));\r\n        props.disableButton(false);\r\n      } else {\r\n        console.log('[Extension.js] Can\\'t find existing sheet settings');\r\n        initializeMeta()\r\n          .then(meta => {\r\n            props.updateMeta(meta);\r\n            setSettings('sheets', meta);\r\n            setSettings('label', 'Export All');\r\n            return saveSettings();\r\n          })\r\n          .then(meta => configure(meta));\r\n      }\r\n\r\n      let labelSettings = tableau.extensions.settings.get('buttonLabel');\r\n\r\n      if (labelSettings && labelSettings != null) {\r\n        labelSettings = labelSettings.replace(/\"/g,'');\r\n        console.log('[Extension.js] initializeAsync Existing Label Settings Found', labelSettings);\r\n        props.updateLabel(labelSettings);\r\n      }\r\n\r\n      let styleSettings = tableau.extensions.settings.get('buttonStyle');\r\n\r\n      if (styleSettings && styleSettings != null) {\r\n        console.log('[Extension.js] initializeAsync Existing Label Style Found', styleSettings);\r\n        props.updateButtonStyle(styleSettings);\r\n      }\r\n\r\n      let filenameSettings = tableau.extensions.settings.get('filename');\r\n\r\n      if (filenameSettings && filenameSettings != null) {\r\n        console.log('[Extension.js] initializeAsync Existing Filename Found', filenameSettings);\r\n        props.updateFilename(filenameSettings);\r\n      }\r\n\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  function refreshSettings() {\r\n    let sheetSettings = tableau.extensions.settings.get('selectedSheets');\r\n\r\n    if (sheetSettings && sheetSettings != null) {\r\n      const existingSettings = JSON.parse(sheetSettings);\r\n      console.log('[Extension.js] refreshSettings Existing Sheet Settings Found. Refreshing', JSON.stringify(existingSettings));\r\n      revalidateMeta(existingSettings)\r\n        .then(meta => {\r\n          console.log('[Extension.js] refreshSettings settings revalidated',JSON.stringify(meta));\r\n          props.updateMeta(meta);\r\n          props.disableButton(false);\r\n        });\r\n    }\r\n\r\n    let labelSettings = tableau.extensions.settings.get('buttonLabel');\r\n\r\n    if (labelSettings && labelSettings != null) {\r\n      labelSettings = labelSettings.replace(/\"/g,'');\r\n      console.log('[Extension.js] refreshSettings Existing Label Settings Found', labelSettings);\r\n      props.updateLabel(labelSettings);\r\n    }\r\n\r\n    let styleSettings = tableau.extensions.settings.get('buttonStyle');\r\n\r\n    if (styleSettings && styleSettings != null) {\r\n      console.log('[Extension.js] refreshSettings Existing Label Style Found', styleSettings);\r\n      props.updateButtonStyle(styleSettings);\r\n    }\r\n\r\n    let filenameSettings = tableau.extensions.settings.get('filename');\r\n\r\n    if (filenameSettings && filenameSettings != null) {\r\n      console.log('[Extension.js] refreshSettings Existing Filename Found', filenameSettings);\r\n      props.updateFilename(filenameSettings);\r\n    }\r\n  }\r\n\r\n  function configure () {\r\n    console.log('[Extension.js] Opening configure popup');\r\n    const popupUrl = `${window.location.origin}/configure`;\r\n    tableau.extensions.ui.displayDialogAsync(popupUrl, null, { height: 500, width: 500 }).then((closePayload) => {\r\n      refreshSettings();\r\n      console.log('[Extension.js] Config window closed', props)\r\n    }).catch((error) => {\r\n      switch(error.errorCode) {\r\n        case tableau.ErrorCodes.DialogClosedByUser:\r\n          console.log('[Extension.js] Dialog was closed by user');\r\n          refreshSettings();\r\n          break;\r\n        default:\r\n          console.error('[Extension.js]', error.message);\r\n      }\r\n    });\r\n  }\r\n\r\n  function clickExportHandler() {\r\n    let sheetSettings = tableau.extensions.settings.get('selectedSheets');\r\n    const meta = JSON.parse(sheetSettings);\r\n    if (tableau.extensions.environment.context === \"server\") {\r\n      exportToExcel(meta, 'server', props.filename);\r\n    } else {\r\n      console.log('[Extension.js] Tableau Version', tableau.extensions.environment.tableauVersion);\r\n      if (compareVersions.compare(tableau.extensions.environment.tableauVersion, '2019.4.0', '>=') ) {\r\n        exportToExcel(meta, 'desktop', props.filename);\r\n      } else {\r\n        desktopExportHandler ();\r\n      }\r\n    }\r\n  }\r\n\r\n  function desktopExportHandler () {\r\n    const popupUrl = `${window.location.origin}/desktopexport`;\r\n    tableau.extensions.ui.displayDialogAsync(popupUrl, '', { height: 350, width: 400 }).then((closePayload) => {\r\n      console.log('[Extension.js] Export window closed')\r\n    }).catch((error) => {\r\n      switch(error.errorCode) {\r\n        case tableau.ErrorCodes.DialogClosedByUser:\r\n          console.log('[Extension.js] Export window was closed by user');\r\n          break;\r\n        default:\r\n          console.error('[Extension.js]', error.message);\r\n      }\r\n    });\r\n  }\r\n\r\n  return (\r\n    <ExportBtn label={props.label} style={props.style} disabled={props.disabled} export={clickExportHandler}></ExportBtn>\r\n  );\r\n}\r\n\r\nexport default Extension;\r\n","import React from 'react';\r\nimport { Checkbox, TextField, Stepper } from '@tableau/tableau-ui';\r\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\r\nimport MuiAccordion from '@material-ui/core/Accordion';\r\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\r\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: {\r\n    width: '100%',\r\n  },\r\n  heading: {\r\n    fontSize: theme.typography.pxToRem(15),\r\n  },\r\n  details: {\r\n    alignItems: 'center',\r\n  },\r\n  column: {\r\n    flexBasis: '50%',\r\n  },\r\n  label: {\r\n    display: 'block',\r\n    fontSize: 12,\r\n    lineHeight: '21px',\r\n    order: 0\r\n  },\r\n  group: {\r\n    color: 'rgba(0, 0, 0, 0.56)',\r\n    display: 'inline-flex',\r\n    flexDirection: 'column',\r\n    fontFamily: 'Benton Sans, Arial, Helvetica, sans-serif',\r\n    position: 'relative',\r\n  },\r\n  strikeThrough: {\r\n    textDecoration: 'line-through',\r\n    marginRight: 5,\r\n    color: 'rgba(156, 156, 156, 0.8)',\r\n  }\r\n}));\r\n\r\nconst Accordion = withStyles({\r\n  root: {\r\n    boxShadow: 'none',\r\n    '&:not(:last-child)': {\r\n      borderBottom: 0,\r\n    },\r\n    '&:before': {\r\n      display: 'none',\r\n    },\r\n    '&$expanded': {\r\n      margin: 'auto',\r\n    },\r\n  },\r\n  expanded: {},\r\n})(MuiAccordion);\r\n\r\nfunction Sheet(props) {\r\n\r\n  const classes = useStyles();\r\n\r\n  const inputProps = {\r\n    label: 'Rename',\r\n    onChange: e => props.changeName(e.target.value),\r\n    onClear: () => {\r\n      props.changeName(null); \r\n    },\r\n    placeholder: props.name || 'Override Export Tab Name',\r\n    style: { width: 200 },\r\n    value: props.rename || '',\r\n  };\r\n\r\n  function renderSheetName(name, rename) {\r\n    if (rename) {\r\n      return (\r\n        <div>\r\n          <span className={classes.strikeThrough}>{name}</span>\r\n          <span>{rename}</span>\r\n        </div>\r\n      )\r\n    }\r\n    return (\r\n      <div>{name}</div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Accordion square expanded={props.selected}>\r\n        <AccordionSummary\r\n          aria-controls=\"panel1c-content\"\r\n          id=\"panel1c-header\"\r\n        >\r\n          <div>\r\n            <Checkbox checked={props.selected} onChange={props.select}>{renderSheetName(props.name, props.rename)}</Checkbox>\r\n          </div>\r\n        </AccordionSummary>\r\n        <AccordionDetails className={classes.details}>\r\n          <div className={classes.column}>\r\n            <TextField {...inputProps} />\r\n          </div>\r\n          <div className={classes.column}>\r\n            <div className={classes.group}>\r\n              <label className={classes.label}>Change Order</label>\r\n              <Stepper min={1} max={props.sheets.length} step={1} pageSteps={1} value={props.id + 1} onValueChange={value => props.changeOrder(value)} className={classes.stepper} />\r\n            </div>\r\n          </div>\r\n        </AccordionDetails>\r\n      </Accordion>\r\n    </div>\r\n  );\r\n\r\n}\r\n\r\nexport default Sheet;\r\n","import React from 'react';\r\nimport Sheet from './Sheet/Sheet'\r\n\r\nfunction SelectSheets(props) {\r\n\r\n  if (props && props.sheets) {\r\n    return props.sheets.map((sheet, index) => {\r\n      return (\r\n        <Sheet\r\n          id={index}\r\n          key={sheet.sheetName}\r\n          name={sheet.sheetName}\r\n          rename={sheet.changeName}\r\n          sheets={props.sheets}\r\n          selected={sheet.selected}\r\n          select={() => props.selectSheet(index)}\r\n          changeName={(name) => props.changeName(index,name)}\r\n          changeOrder={(newPos) => props.changeOrder(index,newPos)}\r\n          />\r\n      );\r\n    });\r\n  } else {\r\n    return (\r\n      <div></div>\r\n    )\r\n  }\r\n\r\n}\r\n\r\nexport default SelectSheets;\r\n","import React from 'react';\r\nimport { Checkbox, TextField, Stepper } from '@tableau/tableau-ui';\r\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\r\nimport MuiAccordion from '@material-ui/core/Accordion';\r\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\r\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: {\r\n    width: '100%',\r\n  },\r\n  heading: {\r\n    fontSize: theme.typography.pxToRem(15),\r\n  },\r\n  details: {\r\n    alignItems: 'center',\r\n  },\r\n  column: {\r\n    flexBasis: '50%',\r\n  },\r\n  label: {\r\n    display: 'block',\r\n    fontSize: 12,\r\n    lineHeight: '21px',\r\n    order: 0,\r\n  },\r\n  group: {\r\n    color: 'rgba(0, 0, 0, 0.56)',\r\n    display: 'inline-flex',\r\n    flexDirection: 'column',\r\n    fontFamily: 'Benton Sans, Arial, Helvetica, sans-serif',\r\n    position: 'relative',\r\n  },\r\n  strikeThrough: {\r\n    textDecoration: 'line-through',\r\n    color: 'rgba(156, 156, 156, 0.8)',\r\n    marginRight: 5,\r\n  }\r\n}));\r\n\r\nconst ExpansionPanel = withStyles({\r\n  root: {\r\n    boxShadow: 'none',\r\n    '&:not(:last-child)': {\r\n      borderBottom: 0,\r\n    },\r\n    '&:before': {\r\n      display: 'none',\r\n    },\r\n    '&$expanded': {\r\n      margin: 'auto',\r\n    },\r\n  },\r\n  expanded: {},\r\n})(MuiAccordion);\r\n\r\nfunction Column(props) {\r\n\r\n  const classes = useStyles();\r\n\r\n  const inputProps = {\r\n    label: 'Rename',\r\n    onChange: e => props.changeName(e.target.value),\r\n    onClear: () => {\r\n      props.changeName(null);\r\n    },\r\n    placeholder: props.name || 'Override Export Column Name',\r\n    style: { width: 200 },\r\n    value: props.rename || '',\r\n  };\r\n\r\n  function renderColName(name, rename) {\r\n    if (rename) {\r\n      return (\r\n        <div>\r\n          <span className={classes.strikeThrough}>{name}</span>\r\n          <span>{rename}</span>\r\n        </div>\r\n      )\r\n    }\r\n    return (\r\n      <div>{name}</div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <ExpansionPanel square>\r\n        <AccordionSummary\r\n          expandIcon={<ExpandMoreIcon />}\r\n          aria-controls=\"panel1c-content\"\r\n          id=\"panel1c-header\"\r\n        >\r\n          <div>\r\n            <Checkbox checked={props.selected} onChange={props.select}>{renderColName(props.name, props.rename)}</Checkbox>\r\n          </div>\r\n        </AccordionSummary>\r\n        <AccordionDetails className={classes.details}>\r\n          <div className={classes.column}>\r\n            <TextField {...inputProps} />\r\n          </div>\r\n          <div className={classes.column}>\r\n            <div className={classes.group}>\r\n              <label className={classes.label}>Change Order</label>\r\n              <Stepper min={1} max={props.cols.length} step={1} pageSteps={1} value={props.id + 1} onValueChange={value => props.changeOrder(value)} className={classes.stepper} />\r\n            </div>\r\n          </div>\r\n        </AccordionDetails>\r\n      </ExpansionPanel>\r\n    </div>\r\n  );\r\n\r\n}\r\n\r\nexport default Column;\r\n","import React from 'react';\r\nimport Column from './Column/Column'\r\n\r\nfunction Sheets(props) {\r\n\r\n  if (props && props.cols) {\r\n    return props.cols.map((col, index) => {\r\n      return (\r\n        <Column\r\n          id={index}\r\n          key={col.index}\r\n          name={col.name}\r\n          rename={col.changeName}\r\n          selected={col.selected}\r\n          select={() => props.colSelect(props.id, index)}\r\n          changeName={(name) => props.changeName(props.id, index, name)}\r\n          cols={props.cols}\r\n          changeOrder={(newPos) => props.changeOrder(props.id, index, newPos)}\r\n          />\r\n      );\r\n    });\r\n  } else {\r\n    return (\r\n      <div></div>\r\n    )\r\n  }\r\n\r\n}\r\n\r\nexport default Sheets;\r\n","import React from 'react';\r\nimport Sheet from './Sheet/Sheet'\r\n\r\nfunction SelectColumns(props) {\r\n\r\n  if (props && props.sheets) {\r\n    return props.sheets.map((sheet, index) => {\r\n      if (sheet.selected) {\r\n        return (\r\n          <div key={sheet.sheetName}>\r\n            <div><b>{sheet.sheetName}</b></div>\r\n            <Sheet\r\n              id={index}\r\n              name={sheet.sheetName}\r\n              cols={sheet.columns}\r\n              colSelect={props.colSelect}\r\n              changeName={props.changeName}\r\n              changeOrder={props.changeOrder}\r\n              />\r\n          </div>\r\n        );\r\n      } else {\r\n        return (\r\n          <div key={sheet.sheetName}></div>\r\n        )\r\n      }\r\n    });\r\n  } else {\r\n    return (\r\n      <div></div>\r\n    )\r\n  }\r\n\r\n}\r\n\r\nexport default SelectColumns;\r\n","import React from 'react';\r\nimport { Button } from '@tableau/tableau-ui';\r\nimport packageJson from '../../../../package.json';\r\n\r\nconst placeButtons = {\r\n  bottom: 10,\r\n  right: 10,\r\n  position: 'fixed'\r\n}\r\n\r\nconst version = {\r\n  left: 10,\r\n  bottom: 10,\r\n  position: 'fixed',\r\n  color: '#4f4f4f',\r\n  fontSize: 12\r\n}\r\n\r\nfunction ActionButtons(props) {\r\n\r\n  return (\r\n    <div>\r\n      <div style={version}>v{packageJson.version}</div>\r\n      <div style={placeButtons}>\r\n        <Button kind={'outline'} style={{marginRight: 12}} onClick={props.resetSettings}>Reset</Button>\r\n        <Button kind={'primary'} style={{marginRight: 12}} disabled={!props.enableButton} onClick={props.save}>Save Changes</Button>\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default ActionButtons;\r\n","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport { TextField, DropdownSelect } from '@tableau/tableau-ui';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: {\r\n    flexGrow: 1,\r\n  },\r\n  gridItem: {\r\n    marginTop: 10\r\n  }\r\n}));\r\n\r\nfunction ConfigureTab(props) {\r\n  const classes = useStyles();\r\n\r\n  const labelProps = {\r\n    label: 'Button Label',\r\n    onChange: e => {\r\n      console.log('[ConfigureTab.js] Updating Button Label',e.target.value)\r\n      props.updateLabel(e.target.value)\r\n    },\r\n    onClear: () => {\r\n      props.updateLabel('Export All');\r\n    },\r\n    placeholder: 'Button Label',\r\n    style: { width: 400 },\r\n    value: props.label || '',\r\n  };\r\n\r\n  const filenameProps = {\r\n    label: 'Export Filename',\r\n    onChange: e => props.updateFilename(JSON.stringify(e.target.value)),\r\n    onClear: () => {\r\n      props.updateFilename('ExportAll');\r\n    },\r\n    placeholder: 'Export Filename',\r\n    style: { width: 400 },\r\n    value: props.filename || '',\r\n  };\r\n\r\n  const styleDropDown = {\r\n    marginLeft: 10\r\n  }\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Grid container>\r\n        <Grid item xs={12}>\r\n          <TextField {...labelProps} />\r\n        </Grid>\r\n        <Grid item xs={12} className={classes.gridItem}>\r\n          <TextField {...filenameProps} />\r\n        </Grid>\r\n        <Grid item xs={12} className={classes.gridItem}>\r\n          <React.Fragment>\r\n            Set Button Style to:\r\n            <DropdownSelect kind='line' value={props.style} onChange={e => props.updateButtonStyle(JSON.stringify(e.target.value))} style={styleDropDown}>\r\n              <option>outline</option>\r\n              <option>primary</option>\r\n              <option>destructive</option>\r\n            </DropdownSelect>\r\n          </React.Fragment>\r\n        </Grid>\r\n      </Grid>\r\n    </div>\r\n  )\r\n\r\n}\r\n\r\nexport default ConfigureTab;\r\n","export default __webpack_public_path__ + \"static/media/logo.18a2e2ee.svg\";","import React, { useState, useEffect } from 'react';\r\nimport { Tabs } from '@tableau/tableau-ui';\r\nimport SelectSheets from './SelectSheets/SelectSheets';\r\nimport SelectColumns from './SelectColumns/SelectColumns';\r\nimport ActionButtons from './ActionButtons/ActionButtons';\r\nimport ConfigureTab from './ConfigureTab/ConfigureTab';\r\nimport { saveSettings, setSettings, initializeMeta, revalidateMeta } from '../func/func';\r\nimport logo from './logo.svg';\r\nimport './Configure.css';\r\n\r\n// Declare this so our linter knows that tableau is a global object\r\n/* global tableau */\r\n\r\nconst configBody = {\r\n  height: 'calc(100vh - 170px)',\r\n}\r\n\r\nconst logoBanner = {\r\n  backgroundColor: 'rgb(245, 245, 245)',\r\n  height: 26,\r\n  paddingTop: 12,\r\n  paddingBottom: 12,\r\n  paddingLeft: 18,\r\n}\r\n\r\nfunction Configure(props) {\r\n  const [tab, switchTab] = useState(0);\r\n  const tabs = [ { content: 'Select Sheets'}, { content: 'Select Columns' }, { content: 'Configure' } ];\r\n\r\n  useEffect(() => {\r\n    console.log('[Configure.js] useEffect');\r\n    //Initialise Extension\r\n    tableau.extensions.initializeDialogAsync().then((openPayload) => {\r\n\r\n      console.log('[Configure.js] Initialise Dialog', openPayload);\r\n\r\n      let sheetSettings = tableau.extensions.settings.get('selectedSheets');\r\n\r\n      if (sheetSettings && sheetSettings != null) {\r\n        const existingSettings = JSON.parse(sheetSettings);\r\n        console.log('[Configure.js] Existing Sheet Settings Found', sheetSettings);\r\n        revalidateMeta(existingSettings)\r\n          .then(meta => {\r\n            props.updateMeta(meta);\r\n          });\r\n      }\r\n\r\n      let labelSettings = tableau.extensions.settings.get('buttonLabel');\r\n\r\n      if (labelSettings && labelSettings != null) {\r\n        labelSettings = labelSettings.replace(/\"/g,'');\r\n        console.log('[Configure.js] initializeDialogAsync Existing Label Settings Found', labelSettings);\r\n        props.updateLabel(labelSettings);\r\n      }\r\n\r\n      let styleSettings = tableau.extensions.settings.get('buttonStyle');\r\n\r\n      if (styleSettings && styleSettings != null) {\r\n        console.log('[Configure.js] initializeDialogAsync Existing Label Style Found', styleSettings);\r\n        props.updateButtonStyle(styleSettings);\r\n      }\r\n\r\n      let filenameSettings = tableau.extensions.settings.get('filename');\r\n\r\n      if (filenameSettings && filenameSettings != null) {\r\n        console.log('[Configure.js] initializeDialogAsync Existing Filename Found', filenameSettings);\r\n        props.updateFilename(filenameSettings);\r\n      }\r\n\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  function selectSheetHandler(i) {\r\n    console.log('[Configure.js] selectSheetHandler', i);\r\n    const meta = props.meta;\r\n    meta[i].selected = !meta[i].selected;\r\n    props.updateMeta(meta);\r\n    props.changeSettings(true);\r\n  }\r\n\r\n  function selectColumnHandler(sheetIdx, colIdx) {\r\n    console.log('[Configure.js] selectColumnHandler', sheetIdx, colIdx);\r\n    const meta = props.meta;\r\n    const sheet = meta[sheetIdx];\r\n    sheet.columns[colIdx].selected = !sheet.columns[colIdx].selected;\r\n    meta[sheetIdx] = sheet;\r\n    props.updateMeta(meta);\r\n    props.changeSettings(true);\r\n  }\r\n\r\n  function changeSheetNameHandler(i, name) {\r\n    console.log('[Configure.js] changeSheetNameHandler', i, name);\r\n    const meta = props.meta;\r\n    meta[i].changeName = name;\r\n    props.updateMeta(meta);\r\n    props.changeSettings(true);\r\n  }\r\n\r\n  function changeColumnNameHandler(sheetIdx, colIdx, name) {\r\n    console.log('[Configure.js] changeColumnNameHandler', sheetIdx, colIdx, name);\r\n    const meta = props.meta;\r\n    const sheet = meta[sheetIdx];\r\n    sheet.columns[colIdx].changeName = name;\r\n    meta[sheetIdx] = sheet;\r\n    props.updateMeta(meta);\r\n    props.changeSettings(true);\r\n  }\r\n\r\n  function array_move(arr, old_index, new_index) {\r\n    if (new_index >= arr.length) {\r\n        var k = new_index - arr.length + 1;\r\n        while (k--) {\r\n            arr.push(undefined);\r\n        }\r\n    }\r\n    arr.splice(new_index, 0, arr.splice(old_index, 1)[0]);\r\n    return arr;\r\n  };\r\n\r\n  function changeSheetOrderHandler(i, newPos) {\r\n    console.log('[Configure.js] changeSheetOrderHandler', i, newPos);\r\n    if (newPos > 0) {\r\n      const meta = array_move(props.meta, i, newPos - 1);\r\n      props.updateMeta(meta);\r\n      props.changeSettings(true);\r\n    }\r\n  }\r\n\r\n  function changeColumnOrderHandler(sheetIdx, colIdx, newPos) {\r\n    console.log('[Configure.js] changeColumnOrderHandler', sheetIdx, colIdx, newPos);\r\n    if (newPos > 0) {\r\n      const meta = props.meta;\r\n      const sheet = meta[sheetIdx];\r\n      const columns = array_move(sheet.columns, colIdx, newPos - 1);\r\n      columns.map((col, idx) => {\r\n        col.order = idx;\r\n        return col;\r\n      });\r\n      meta[sheetIdx].columns = columns;\r\n      props.updateMeta(meta);\r\n      props.changeSettings(true);\r\n    }\r\n  }\r\n\r\n  function updateLabelHandler(label) {\r\n    console.log('[Configure.js] changeUpdateLabelHandler', label);\r\n    props.updateLabel(label);\r\n    props.changeSettings(true);\r\n  }\r\n\r\n  function updateButtonStyleHandler(style) {\r\n    console.log('[Configure.js] changeLabelStyleHandler', style);\r\n    props.updateButtonStyle(style);\r\n    props.changeSettings(true);\r\n  }\r\n\r\n  function updateFilenameHandler(filename) {\r\n    console.log('[Configure.js] updateFilenameHandler', filename);\r\n    props.updateFilename(filename);\r\n    props.changeSettings(true);\r\n  }\r\n\r\n  function saveSettingsHandler() {\r\n    console.log('[Configure.js] saveSettingsHandler - Saving Settings', props);\r\n    const meta = props.meta;\r\n    const label = props.label;\r\n    const style = props.style;\r\n    const filename = props.filename;\r\n    props.disableButton(false);\r\n    console.log('[Configure.js] saveSettingsHandler - sheets', meta);\r\n    setSettings('sheets', meta)\r\n      .then(setSettings('label', label))\r\n      .then(setSettings('style', style))\r\n      .then(setSettings('filename', filename))\r\n      .then(saveSettings())\r\n      .then((savedSettings) => {\r\n        console.log('[Configure.js] Saved Settings', savedSettings);\r\n        props.changeSettings(false);\r\n        let sheetSettings = tableau.extensions.settings.get('selectedSheets');\r\n        if (sheetSettings && sheetSettings != null) {\r\n          const existingSettings = JSON.parse(sheetSettings);\r\n          console.log('[Configure.js] Sheet Settings Updated', existingSettings);\r\n        }\r\n      })\r\n  }\r\n\r\n  function resetSettingsHandler() {\r\n    console.log('[Configure.js] resetSettingsHandler - Reset Settings');\r\n    initializeMeta()\r\n      .then(meta => {\r\n        props.updateMeta(meta);\r\n      });\r\n  }\r\n\r\n  return (\r\n      <div>\r\n      <div style={logoBanner}><img style={{height:20}} src={logo} alt='The Information Lab'/></div>\r\n      <Tabs\r\n        onTabChange={(index) => {\r\n          switchTab(index);\r\n        }}\r\n        selectedTabIndex={tab}\r\n        tabs={tabs}\r\n        ><div style={configBody}>\r\n          { tab === 0 ? <SelectSheets sheets={props.meta} selectSheet={selectSheetHandler} changeOrder={changeSheetOrderHandler} changeName={changeSheetNameHandler} /> : null }\r\n          { tab === 1 ? <SelectColumns sheets={props.meta} colSelect={selectColumnHandler} changeName={changeColumnNameHandler} changeOrder={changeColumnOrderHandler}/> : null }\r\n          { tab === 2 ? <ConfigureTab label={props.label} filename={props.filename} style={props.style} updateLabel={updateLabelHandler} updateButtonStyle={updateButtonStyleHandler} updateFilename={updateFilenameHandler}/> : null }\r\n        </div>\r\n      </Tabs>\r\n      <ActionButtons enableButton={props.enableSave} save={saveSettingsHandler} resetSettings={resetSettingsHandler} />\r\n      </div>\r\n  );\r\n}\r\n\r\nexport default Configure;\r\n","import React, { useEffect } from 'react';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport './DesktopExport.css';\r\n// import { exportToExcel } from '../func/func';\r\n\r\n// Declare this so our linter knows that tableau is a global object\r\n/* global tableau */\r\n\r\nfunction DesktopExport() {\r\n\r\n  console.log('[DesktopExport.js] Initialise Export Screen');\r\n\r\n  useEffect(() => {\r\n    console.log('[DesktopExport.js] useEffect');\r\n    //Initialise Extension\r\n    tableau.extensions.initializeDialogAsync().then((openPayload) => {\r\n\r\n      console.log('[DesktopExport.js] Initialise Dialog', openPayload);\r\n\r\n      let sheetSettings = tableau.extensions.settings.get('selectedSheets');\r\n\r\n      if (sheetSettings && sheetSettings != null) {\r\n        // console.log('[DesktopExport.js] Existing Sheet Settings Found', sheetSettings);\r\n        // const meta = JSON.parse(sheetSettings);\r\n        // exportToExcel(meta, 'desktop')\r\n        //   .then((blob) => {\r\n        //     navigator.webkitPersistentStorage.requestQuota (\r\n        //         blob.byteLength, function(grantedBytes) {\r\n        //             window.webkitRequestFileSystem(window.PERSISTENT, grantedBytes, onInitFs, handleError);\r\n        //\r\n        //         }, function(e) { console.log('Error', e); }\r\n        //     );\r\n        //   });\r\n      }\r\n\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (\r\n    <Grid\r\n      container\r\n      spacing={0}\r\n      align=\"left\"\r\n      justify=\"center\"\r\n    >\r\n      <Grid item>\r\n        <Typography component=\"div\" style={{padding: 20}}>\r\n          <p>Hi There!</p>\r\n          <p>It looks like you're trying to create the Excel file using a desktop version earlier than 2019.4. Unfortunately you {\"can't\"} as the download function is disabled, however there are two solutions. Either publish your dashboard to Server where the Excel file will download as expected, or upgrade your copy of Desktop to 2019.4 or greater.</p>\r\n          <p>To those who've previously emailed Tableau to request they enable the download feature...we did it!! Thank you so much for taking the time to present the case, I {\"can't\"} believe how many emails you sent. {\"I'm\"} humbled.</p>\r\n          <p>Craig</p>\r\n        </Typography>\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n\r\nexport default DesktopExport;\r\n","import React, { Component }  from 'react';\r\nimport { BrowserRouter, Route, Switch } from 'react-router-dom';\r\nimport Extension from '../components/Extension/Extension';\r\nimport Configure from '../components/Configure/Configure';\r\nimport DesktopExport from '../components/DesktopExport/DesktopExport';\r\nimport './Main.css';\r\n\r\nclass Main extends Component {\r\n\r\n  constructor(props) {\r\n    console.log('[Main.js] new constructor');\r\n    super(props);\r\n    this.state = {\r\n      meta : undefined,\r\n      metaVersion: 2,\r\n      button: {\r\n        label : 'Export All',\r\n        style: 'outline',\r\n        disabled : true\r\n      },\r\n      isLoading: false,\r\n      filename: 'ExportAll',\r\n      settingsChanged: false,\r\n    };\r\n    console.log('[Main.js] state initialised', this.state);\r\n  }\r\n\r\n  componentWillMount () {\r\n    console.log('[Main.js] componentWillMount');\r\n  }\r\n\r\n  componentDidMount() {\r\n    console.log('[Main.js] componentDidMount');\r\n  }\r\n\r\n  metaVersionChangedHandler = (version) => {\r\n    console.log(`[Main.js] Updating meta version to ${version}`);\r\n    this.setState({metaVersion: version});\r\n  }\r\n\r\n  labelChangedHandler = (labelTxt) => {\r\n    console.log(`[Main.js] Updating label text to ${labelTxt}`);\r\n    const button = {...this.state.button, label: labelTxt};\r\n    this.setState({button});\r\n  }\r\n\r\n  filenameChangedHandler = (filename) => {\r\n    console.log(`[Main.js] Updating filename to ${JSON.parse(filename)}`);\r\n    this.setState({filename: JSON.parse(filename)});\r\n  }\r\n\r\n  buttonStateChangedHandler = (disabled) => {\r\n    console.log(`[Main.js] Changing button state to ${disabled}`);\r\n    const button = {...this.state.button, disabled};\r\n    this.setState({button});\r\n  }\r\n\r\n  buttonStyleChangedHandler = (style) => {\r\n    console.log(`[Main.js] Changing button style to ${style}`);\r\n    const button = {...this.state.button, style: JSON.parse(style)};\r\n    this.setState({button});\r\n  }\r\n\r\n  metaChangedHandler = (newSettings) => {\r\n    console.log('[Main.js] Meta changed', newSettings);\r\n    this.setState({meta: newSettings});\r\n  }\r\n\r\n  settingsChangedHandler = (state) => {\r\n    console.log('[Main.js] Settings changed', state);\r\n    this.setState({settingsChanged: state});\r\n  }\r\n\r\n  resetSettingsHandler = () => {\r\n    console.log('[Main.js] Reset Settings');\r\n    this.setState({\r\n      meta : undefined,\r\n      metaVersion: 2,\r\n      button: {\r\n        label : 'Export All',\r\n        style: 'outline',\r\n        disabled : true\r\n      },\r\n      isLoading: false,\r\n      filename: 'ExportAll',\r\n      settingsChanged: false,\r\n    });\r\n  }\r\n\r\n  renderExtension = () => {\r\n    return (\r\n      <Extension \r\n        label={this.state.button.label} \r\n        meta={this.state.meta}\r\n        metaVersion={this.state.metaVersion}\r\n        style={this.state.button.style} \r\n        filename={this.state.filename} \r\n        disabled={this.state.button.disabled} \r\n        updateMetaVersion={this.metaVersionChangedHandler}\r\n        updateMeta={this.metaChangedHandler} \r\n        disableButton={this.buttonStateChangedHandler} \r\n        updateLabel={this.labelChangedHandler}  \r\n        updateButtonStyle={this.buttonStyleChangedHandler} \r\n        updateFilename={this.filenameChangedHandler} />\r\n    )\r\n  }\r\n\r\n  renderConfigure = () => {\r\n    return (\r\n      <Configure \r\n        label={this.state.button.label} \r\n        meta={this.state.meta} \r\n        style={this.state.button.style} \r\n        filename={this.state.filename} \r\n        enableSave={this.state.settingsChanged} \r\n        updateMeta={this.metaChangedHandler} \r\n        disableButton={this.buttonStateChangedHandler} \r\n        updateLabel={this.labelChangedHandler} \r\n        changeSettings={this.settingsChangedHandler} \r\n        updateButtonStyle={this.buttonStyleChangedHandler} \r\n        updateFilename={this.filenameChangedHandler} \r\n        resetSettings={this.resetSettingsHandler}/>\r\n    )\r\n  }\r\n\r\n  renderDesktopExport = () => {\r\n    return (\r\n      <DesktopExport />\r\n    )\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <BrowserRouter>\r\n        <Switch>\r\n          <Route path=\"/configure\">\r\n            <Configure \r\n              label={this.state.button.label} \r\n              meta={this.state.meta} \r\n              style={this.state.button.style} \r\n              filename={this.state.filename} \r\n              enableSave={this.state.settingsChanged} \r\n              updateMeta={this.metaChangedHandler} \r\n              disableButton={this.buttonStateChangedHandler} \r\n              updateLabel={this.labelChangedHandler} \r\n              changeSettings={this.settingsChangedHandler} \r\n              updateButtonStyle={this.buttonStyleChangedHandler} \r\n              updateFilename={this.filenameChangedHandler} \r\n              resetSettings={this.resetSettingsHandler}/>\r\n          </Route>\r\n          <Route path=\"/desktopexport\">\r\n            <DesktopExport />\r\n          </Route>\r\n          <Route path=\"/\">\r\n            <Extension \r\n              label={this.state.button.label} \r\n              meta={this.state.meta}\r\n              metaVersion={this.state.metaVersion}\r\n              style={this.state.button.style} \r\n              filename={this.state.filename} \r\n              disabled={this.state.button.disabled} \r\n              updateMetaVersion={this.metaVersionChangedHandler}\r\n              updateMeta={this.metaChangedHandler} \r\n              disableButton={this.buttonStateChangedHandler} \r\n              updateLabel={this.labelChangedHandler}  \r\n              updateButtonStyle={this.buttonStyleChangedHandler} \r\n              updateFilename={this.filenameChangedHandler} />\r\n          </Route>\r\n        </Switch>\r\n      </BrowserRouter>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Main;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import 'react-app-polyfill/ie11';\r\nimport 'react-app-polyfill/stable';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport Main from './containers/Main';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<Main />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}